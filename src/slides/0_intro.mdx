import {Heading, Text, Quote, Appear, Link, Grid, Box, FlexBox, SlideContext} from 'spectacle'
import Paper from '@material-ui/core/Paper'
import Card from '@material-ui/core/Card';
import CardContent from '@material-ui/core/CardContent';
import Typography from '@material-ui/core/Typography';
import VerticalLinearStepper from '../components/vertical_stepper'
import SvgAnimator from '../components/svg_animator';
import Plax from '../img/plax_3_closed_loop.svg'
import TitleCard from '../img/cover.svg'
import Overview from '../img/overview-01.svg'
import anime from 'animejs'
import BasicCard, { PositionedCard } from '../components/basiccard';
import {distance} from '../components/utils';
import Stepper from '../components/stepper';
import {PositionedHeading, Collapser} from '../components/basic';
import TextAnimator from '../components/text/TextAnimator';
import ChatAnimator from '../components/text/ChatAnimator';
import UsaAvatar from '../img/usaAvatar.png'
import AmazonLogo from '../img/amazonlogo.png'

<Box width={2/3}>
<Heading
  fontFamily={'headerSerif'}
  fontSize={'100pt'}
  textAlign={'left'}
  lineHeight={1.0}
  fontWeight={'bold'}
>
  Decentralized Infrastructure for (Neuro)science
</Heading>
</Box>
<Text fontFamily="monospace">ION SPECIAL EDITION</Text>
<Text fontFamily="monospace">Full Presentation:<a href="https://jon-e.net/infrastructure-presentation">https://jon-e.net/infrastructure-presentation</a></Text>
<Text fontFamily="monospace">Video of full Presentation: <a href={"https://vimeo.com/589991175"}>https://vimeo.com/589991175</a></Text>
<Text>Jonny Saunders, 2021</Text>

<Box width={2/3} margin={'40px 0'}>
<Quote fontSize={"2em"} fontFamily={"Source Serif Pro"} fontWeight={200} fontStyle={"italic"}>
"If we can make something decentralised, out of control, and of great simplicity, we must be prepared to be astonished at whatever might grow"<br/>
  -Tim Berners-Lee, <a fontSize={"1em"}  href={"https://www.w3.org/1998/02/Potential.html"}>W3C meeting 1997</a>
</Quote>
</Box>

<Box width={2/3} margin={'0 0'}>
  <Quote fontSize={"2em"} fontFamily={"Source Serif Pro"} fontWeight={200} fontStyle={"italic"}>
Information is often a means of domination of both humans and the environment.
The goal is to make information into a tool for liberation.<br/>
    - Brian Martin, 1998, <a fontSize={"1em"} href={"https://documents.uow.edu.au/~bmartin/pubs/98il/ilall.html"}>Information Liberation</a>
  </Quote>
</Box>

---
<SvgAnimator
    svgUrl={TitleCard}
    steps={[
      [
        {
          targets: '#computers-1 '+'#Layer_2 *',
          strokeDashoffset: [anime.setDashoffset, 0],
          duration: anime.random(1000, 2000),
          delay: anime.random(0, 200),
          easing: 'easeInOutCirc',
          loop: false
        },
        {
          targets: '#computers-heading',
          opacity: [0, 1],
          duration: 500,
          easing: 'easeOutQuart'
        }
      ],
      [
        {
          targets: '#computers-1 '+'#Layer_5 *',
          strokeDashoffset: [anime.setDashoffset, 0],
          duration: anime.random(500, 1000),
          delay: function(el){
            let dist = distance(el.getBBox(), {x:1185, y:715})*3;
            console.log('dist', dist);
            return dist;
          },
          easing: 'easeInOutCirc',
          loop: false
        },
        {
          targets: '#computers-1 '+'#Layer_4 *',
          strokeDashoffset: [anime.setDashoffset, 0],
          duration: anime.random(250, 500),
          delay: function(el){
            let dist = distance(el.getBBox(), {x:1185, y:715})*2;
            console.log('dist', dist);
            return dist;
          },
          easing: 'easeInOutCirc',
          loop: false
        },{
        targets: '#computers-1 '+'.cls-4',
        strokeDashoffset: [anime.setDashoffset, 0],
        duration: anime.random(3000, 5000),
        direction: 'alternate',
        delay: anime.random(0, 1000),
        easing: 'easeInOutCirc',
        loop: true
      },
        {
          targets: '#experiment-card',
          opacity: [0, 1],
          duration: 1000,
          delay:1000,
          easing: 'easeOutQuint'
        }],
      [
        {
          targets: '#computers-1 '+'#Layer_6 *',
          strokeDashoffset: [anime.setDashoffset, 0],
          duration: anime.random(500, 1000),
          delay: function(el){
            let dist = distance(el.getBBox(), {x:1306, y:716})*5;
            console.log('dist', dist);
            return dist;
          },
          easing: 'easeInOutCirc',
          loop: false
        },
        {
          targets: '#computers-1 '+'.cls-5',
          strokeDashoffset: [anime.setDashoffset, 0],
          strokeDasharray: [100, anime.setDashoffset],
          duration: anime.random(3000, 8000),
          direction: 'alternate',
          delay: function(el, i) {
            return Math.random() * 5000
          },
          easing: 'linear',
          loop: true
        },
        {
          targets: '#data-card',
          opacity: [0, 1],
          duration: 1000,
          delay:1000,
          easing: 'easeOutQuint'
        }],
      [
        {
          targets: '#computers-1 '+'#Layer_3 *',
          strokeDashoffset: [anime.setDashoffset, 0],
          duration: anime.random(500, 1000),
          delay: function(el){
            let dist = distance(el.getBBox(), {x:1257, y:308})*3;
            console.log('dist', dist);
            return dist;
          },
          easing: 'easeInOutCirc',
          loop: false
        },
        {
          targets: '#share-card',
          opacity: [0, 1],
          duration: 1000,
          delay:1000,
          easing: 'easeOutQuint'
        }
        ],
    [
      {targets:'#computers-smiley-0',
        easing:'easeOutBounce',
      opacity:[0,1],
      scale:[0,1]}
    ],
    [
      {targets:'#computers-smiley-1',
      easing:'easeOutBounce',
        opacity:[0,1],
        scale:[0,1]}
    ],
    [
      {targets:'#computers-smiley-2',
      easing:'easeOutBounce',
        opacity:[0,1],
        scale:[0,1]}
    ]]}
    id={'computers-1'}
/>


<Box width={4/9}
     style={{position:'absolute',
       left:'30px'}}>
  <Heading
    fontFamily={'monospace'}
    fontWeight={'lighter'}
    lineHeight={1.1}
    backgroundColor={"#333333"}
    color={"#ffffff"}
    fontSize={"6em"}
  textAlign={'right'}
  id={"computers-heading"}
  width={4/9}
>What's the<br/>deal with<br/>computers?</Heading>
<Grid gridTemplateColumns={"1fr 1fr 1fr"}>
  <Text fontSize={50} textAlign={'center'} id="computers-smiley-0" fontFamily={'monospace'}>:\</Text>
  <Text fontSize={50} textAlign={'center'} id="computers-smiley-1" fontFamily={'monospace'}>:(</Text>
  <Text fontSize={50} textAlign={'center'} id="computers-smiley-2" fontFamily={'monospace'}>:'(</Text>
</Grid></Box>

Notes: We use computers for much of the everyday practice of science

- Running experiments
- Storing & Analyzing Data
- Communicating and sharing results

But for each of these, we have a fragmented landscape of tools and so everything is *hard* !

---

<div className={'blankslide'}></div>

Notes: I want to talk about something much larger than computers being hard

I want to make the argument that many seemingly-distinct problems have a shared cause:
the near-absence of basic digital infrastructure for science.

This defines the everyday reality of scientific practice, but we often don't even see them as solvable problems because
they are so widespread, interconnected, etc.

By diagnosing the problems as infrastructural, they can be solved instead of patched over!

That ethical or even functional infrastructure is not inevitable, and current development practices are driving us
in precisely the wrong direction

Give a vision of what a system could look like to bring the problem down from abstraction, and how
we can start working on them right here with ONICE.

<hr/>

What I'll have to skip today:
- Like all the detail
- Description of systemic forces in play
- History and sociology of knowledge communities drawn from:
  - pirates,
  - rad hippie internet architects,
  - librarians & information scientists
  - STS scholars
- Landscape of existing technologies

<hr/>

# 1) What are the symptoms of digital deinfrastructuring?

# As a Labor System:

- Fundamentally altered the practice of science so that almost every single field
  is half programming now
- Scientific **labor is prodigiously reduplicated**. reinventing
  everything and redoing the same experiments in every lab, tremendous waste of public funding and human lifespan
- Hidden, systemic dereliction of basic tenets of animal research ethics as we sacrifice many times the animal lives
  that should be necessary for a given question.
- Inequity in labor hierarchy - Most of that labor falls on **ECRs**, creating a labor system where lack of infrastructure
  is papered over by always-expanding needs for cheap labor,
  - armies of undergrads clicking through videos, cleaning data,
  - grad students thrown to the wolves of amateur engineering
- Inequity in labor class - The production of an underclass of technical laborers that do a large proportion
  of the *work* of science but don't have access to the traditional reward mechanisms
  of science (ie. papers)
- Inequity between institutions - Technical and resource knowledge silos make the *rich get richer* as wealthy labs
  and institutes can afford to hire engineers and build sophisticated core facilities,
  do a qualitatively different kind of science, and maintain increasingly disproportionate
  funding

# As a System of Scientific Inquiry:

- Science is cumulative and self-correcting in theory only: since everything is contingent on a fragmented
  body of papers,
  - nothing is ever decided,
  - understanding a field takes literal decades, and
  - interaction between arguments is implicit at best.
- Profoundly leaky knowledge system where entire PhDs worth of data are lost and
  rendered useless as a matter of regular practice just by forgetting what format it's in
  or where it's stored.
- Inevitability of replication crises because it's impossible to replicate experiments
  on rigs that were built once and never documented
- Stunted scientific discourse on for-profit platforms that don't come close to
  satisfying our needs. The widescale adoption of Twitter is not some hideous blessing, but
  evidence of the absolutely dire need for new communication mechanisms and media beyond legacy journals.
- The potential futility of understanding the brain from the limited viewpoint
  of data from a single or small number of labs
  - the advent of centralized high-throughput institutes and platforms like allen brain atlas/observatory are also
    symptoms, there is so much fluorescence microscopy but because there's no means of mutually indexing it we need
    connectivity atlas,
  - but this can't possibly scale to the fullness of the brain, and are dependent on benevolence of billionaires

# Science and its relationship with society

- An absconscion with the public resources we are stewards of, and rather than ensuring that
  every time we solve some technical problem, or learn something new we make it available
  to the public in a medium they can access. Instead we largely make paywalled pdfs,
  in part contributing to public distrust of science --- why would they trust us when
  they have no idea what we do?
  - We should identify the need for "science communication" correctly as a social/cultural problem with science
    but also as an infrastructural one -- people are smart, they just have no idea how to penetrate our opaque science universe

The most profound impact of scientific deinfrastructuring on society will come from
what will happen if we do nothing...

---


<Box width={2 / 3} marginLeft={'auto'} marginRight={'auto'}>

  <Heading fontWeight={200} textAlign={'left'} marginBottom={"2em"}>thought experiment:</Heading>
  <div style={{height: "20px"}}/>
  <Appear id={"aws-1"}>
    <Text>Say we upload all data onto AWS...</Text>
  </Appear>
  <div style={{height: "20px"}}/>
</Box>
<FlexBox justifyContent={'space-evenly'}>
  <Appear height={"100%"} id={"aws-2"}>
    <ChatAnimator
        stepIndex={3}
        isOpen={true}
        agentProfile={{imageUrl: AmazonLogo,
          teamName:"AWS Support"}}
        messages={
          [
            {
              author: 'me',
              type: 'text',
              data: {
                text: 'Sign Up for Science Prime! Subscribe to stream exclusive datasets from elite labs!'
              }
            },
            {
              author: 'me',
              type: 'text',
              data: {
                text: "We're proud to announce a new data sharing agreement with ICE!"
              }
            }
          ]}
    />
  </Appear>
  <Appear height={"100%"} id={"aws-3"}>
    <ChatAnimator
        stepIndex={6}
        isOpen={true}
        agentProfile={{imageUrl: UsaAvatar,
        teamName:"Uncle Sam"}}
        messages={
          [
            {
              author: 'me',
              type: 'text',
              data: {
                text: 'hey amazon, what if you pay taxes?'
              }
            },
            {
              author: 'them',
              type: 'text',
              data: {
                text: 'what if i deleted all scientific knowledge?'
              }
            },
            {
              author: 'them',
              type: 'emoji',
              data: {
                emoji: '😘'
              }
            }
          ]}
    />
  </Appear>


  <Appear stepIndex={9} id={"aws-4"}>
    <Box width={"400px"}>
      <Card elevation={1}>
        <CardContent>
          <Quote fontSize={36}>Google or some similar
            corporate entity [...]
            will come along with its deep pockets, and
            integrate each segment into one grand proprietary Science 2.0
            platform. <br/><br/><strong>Who would not then want to own the obligatory online
              passage point for the bulk of modern scientific research?</strong>
          </Quote>
          <Text fontSize={30}>-Philip Mirowski (2010)
            <Link fontSize={30} href={"https://doi.org/10.1177/0306312718772086"}>
              "The Future(s) of Open Science"</Link></Text>
        </CardContent>
      </Card>
    </Box>
  </Appear>
</FlexBox>


Notes: After slide...

This is not theoretical:

Google gained initial dominance by consolidating, in addition to youtube, doubleclick, etc.
Freebase, a smalltime open source knowledge graph framework that powers its search results

Google DeepMind and OpenAI already own machine learning by just having more computing
infrastructure

---

<SvgAnimator
    svgUrl={Overview}
    steps={[
    [
      {targets:'#rect-data',
      width:[0,750]},
      {
        targets: "#overview-1 #data *",
        strokeDashoffset: {
          value: [anime.setDashoffset, 0],
          duration: 500
        },
        opacity: {
          value: [0, 1],
          duration: 100
        },
      },
      {
        targets: '#overview-1 '+'#data-sparkles *',
        strokeDashoffset: [anime.setDashoffset, 0],
        duration: () => (anime.random(2000, 4000)),
        delay: function(el){
          let dist = distance(el.getBBox(), {x:981, y:782})*5;
          return dist;
        },
        easing: 'easeInOutCirc',
        direction: 'alternate',
        loop: true
      },
    ],
    [
      {targets:'#rect-tools',
        width:[0,750]},
      {
        targets: "#overview-1 #tools *",
        strokeDashoffset: {
          value: [anime.setDashoffset, 0],
          duration: 500
        },
        opacity: {
          value: [0, 1],
          duration: 100
        }
      },
      {
        targets: '#overview-1 '+'#tool-sparkles *',
        strokeDashoffset: [anime.setDashoffset, 0],
        duration: () => (anime.random(1000, 4000)),
        delay: () => (anime.random(1000, 2000)),
        easing: 'easeInOutQuad',
        direction: 'alternate',
        loop: true
      },
      {
        targets: '#overview-1 '+'#analysis-sparkles *',
        strokeDashoffset: [anime.setDashoffset, 0],
        duration: () => (anime.random(1000, 3000)),
        delay: () => (anime.random(1000, 3000)),
        easing: 'easeInOutQuad',
        direction: 'alternate',
        loop: true
      }
    ],
    [
      {targets:'#rect-knowledge',
        width:[0,750]},
      {
        targets: "#overview-1 #knowledge *",
        strokeDashoffset: {
          value: [anime.setDashoffset, 0],
          duration: 500
        },
        opacity: {
          value: [0, 1],
          duration: 100
        }
      },
      {
        targets: '#overview-1 '+'#knowledge-sparkles *',
        strokeDashoffset: [anime.setDashoffset, 0],
        duration: () => (anime.random(1000, 4000)),
        delay: function(el){
          let dist = distance(el.getBBox(), {x:981, y:250})*5;
          return dist;
        },
        easing: 'easeInOutCirc',
        direction: 'alternate',
        loop: true
      }
    ]
    ]}
    id={'overview-1'}
/>

<PositionedHeading light={false}
                   id={'overview-header'}
                   y={20} right={20}
                   headerProps={{fontWeight:700, fontSize:70}}
align={"right"}>
  A Case For</PositionedHeading>
<PositionedHeading light={false}
                   id={'overview-header'}
                   y={100} right={20} align={"right"}
headerProps={{fontSize:80}}>
  Decentralized<br/>Infrastructure</PositionedHeading>


<PositionedHeading
    id={'overview-data'} y={25} x={40} fontSize={50} fontFamily={"Source Serif Pro"} fontWeight={200} fontStyle={'italic'}>
  Semantic Wikis, <br/> Communication & <br/> Governance
</PositionedHeading>

<PositionedHeading id={'overview-knowledge'} y={250} x={40} fontWeight={700}>
  Knowledge
</PositionedHeading>

<PositionedHeading id={'overview-data'} y={390} x={40} fontSize={50} fontFamily={"Source Serif Pro"} fontWeight={200} fontStyle={'italic'}>
  Analytical & <br/> Experimental <br/> Frameworks
</PositionedHeading>


<PositionedHeading id={'overview-tools'} y={620} x={40} fontWeight={700}>
  Tools
</PositionedHeading>

<PositionedHeading id={'overview-data'} y={750} x={40} fontSize={50} fontFamily={"Source Serif Pro"} fontWeight={200} fontStyle={'italic'}>
  Peer-To-Peer<br/>Federated Databases
</PositionedHeading>

<PositionedHeading id={'overview-data'} y={970} x={40} fontWeight={700}>
  Data
</PositionedHeading>

---

# Design Principles

<Box width={2/3} margin={"0 auto"}>
<Quote fontSize={"2em"} fontFamily={"Source Serif Pro"} fontWeight={200} fontStyle={"italic"}>A good analogy for the development of the Internet is that of
  constantly renewing the individual streets and buildings of a city,
  rather than razing the city and rebuilding it. The architectural
  principles therefore aim to provide a framework for creating
  cooperation and standards, as <strong style={{fontWeight:700}}>a small "spanning set" of rules that
    generates a large, varied and evolving space of technology.</strong><br/>
  - <Link href={"https://tools.ietf.org/html/rfc1958"} fontSize={"1em"}>RFC 1958</Link>, Architectural Principles of the Internet
</Quote>
</Box>

<Appear id={'design-principles-1'}>
<Box margin={"auto"} marginTop={"2em"} width={"65%"}>
<VerticalLinearStepper
    steps={[
      {
        title: "Frameworks and Protocols, not Platforms",
        body:
              "Fewer tools, more tools that can build tools"+
              "(so that we can have more tools later)"
      },
      {
        title: "\"Anathemize Techno-Hubris\"",
        body: ""
      },
      {
        title: 'Embrace Heterogeneity, Be Uncoercive',
        body: "Build protocols and systems that let people integrate their labor in a common framework"+
            " but make as few requirements or restrictions about the particular way they do them as possible."+
            " Give people expressive tools that harness their individual expertise and"+
            " experience rather than constrain it."
      },
      {
        title: 'Empower People, not Systems',
        body: 'The Internet Protocol was initially designed as a military technology by DARPA,'+
        ' and was constrained by "survivability." Rather than making the *network* powerful,'+
        ' every individual node could sustain the operation of the whole system. We need tools that'+
        ' dont rely on a small group of people to maintain, a central server-farm to pay for, etc.'+
        ' Empowering tools must be *easy and rewarding to use*. Logic or functionality of a system available'+
        ' to only a small number of users breaks the system. If its hard to turn on a faucet, it aint infrastructure.',
      },
      {
        title: 'Integration, not Invention',
        body: "Build complex systems out of simple components."+
              "Let people adopt things gradually"+
            "Reciprocally: \"the test of independent invention\" -"+
            "if someone else had already invented your system, would theirs work with yours? "+
            "Tools with clear points of interoperability"
      },
    ]}
/>
</Box>
</Appear>

Notes: placeholder

- Anathemize Techno Hubris
  - Not just technological problem, always social and cultural.
  - Must design tools embedded in cultures of practice
- Frameworks and Protocols, not Platforms
  - Rather than designing yet another custom 'high throughput system for x' or 'visualization dashboard for y',
    design systems that capture the logical structure of the problem so that those can be derived
- Heterogeneity
  - Rather than asking everyone to change the way they do science, build a common space for people to express their practice
    in a collectivized system
- Empower People, not Systems
  - Look at all the platforms that have been funded, built, and abandoned when the funding dries up. we need to develop systems
    that have the power in the endpoints so they don't rely on maintaining some shared core.
  - if the system fails, then what?
- Integration
  - Rather than making something new, if we have frameworks, extend them to suit your needs.
  - Reciprocally: design systems so they can be integratable into some future system - "the principle of least power"
